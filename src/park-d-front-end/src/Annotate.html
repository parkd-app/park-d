<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Park'd Labelling</title>
    <link rel="annotorious.min.css" href="styles.css" />
    <link rel="stylesheet" href="annotorious.min.css">
    <script src="./constants.js"></script> <!-- Constants must be loaded first -->
    <script src="annotorious.min.js"></script>
    <script src="./Annotate.js"></script>
    <script src="./adminmap.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="homeView.css" />
    <link rel="stylesheet" href="Annotate.css" />
    <style>
        #map {
            height: 500px;
            width: 50%;
            position: relative;
            /* background-position: right; */
            left: 50%;
            top: 150px;
        }

        #button-panel {
            /* height: 500px; */
            width: 50%;
            position: relative;
            /* background-position: right; */
            left: 50%;
            top: 150px;
        }
    </style>
    <script src="./adminmap.js"></script>
</head>

<body>
    <div class="background">
        <div class="header">
            <div class="logo_bg1">
                <div class="logo_bg2">
                    <span class="logo_text"></span>
                    <div class="logo"></div>
                </div>
                <div class="old_logo"></div>
            </div>
            <a href="HomeView.html">
                <div class="home_bg1">
                    <div class="home_bg2">
                        <div class="home_border"></div>
                        <span class="home_text">Home</span>
                    </div>
                </div>
            </a>
        </div>
        <div class="annotate-window">
            <p>
                <button class="button" id="current-tool">Polygon</button>
                <!-- <button class="button" id="sidebtn" onclick="show('side')">Load Side View</button>
                <button class="button" id="birdbtn" onclick="show('bird')">Load Bird View</button> -->
                <button class="button" id="birdbtn" onclick="saveAnn()">Save Annotations</button>
            </p>
            <div class="ann_image">
                <img id="test_lot" src="" style="max-width:100%;">
                <script>
                    var img = document.getElementById("test_lot");
                    img.src = getSnapshot();
                </script>
            </div>
        </div>
    </div>
    <div id="button-panel">
        <div id="PickLabel">Admin View</div>
        <button type="button" id="RecenterButton" onclick="recenter()">
            Recenter
        </button>
        <div id="LotButtons">
            <label id="IDLabel" for="IDBox">Lot ID:</label>
            <input type="text" id="IDBox" name="IDBox"><br>
            <label id="OwnerLabel" for="OwnerBox">Owner:</label>
            <input type="text" id="OwnerBox" name="OwnerBox"><br>
            <button type="button" id="LoadLotButton" onclick="loadLot()">
                Load Lot
            </button>
            <button type="button" id="NewLotButton" onclick="creatingLot()">
                Create New Lot
            </button>
        </div>
        <div id="NewLotButtons" style="display:none">
            <label id="NewOwnerLabel" for="NewOwnerBox">Owner:</label>
            <input type="text" id="NewOwnerBox" name="NewOwnerBox"><br>
            <label id="URLLabel" for="URLBox">YouTube stream URL:</label>
            <input type="text" id="URLBox" name="URLBox"><br>
            <button type="button" id="CreateLotButton" onclick="createLot()">
                Create Lot
            </button>
        </div>
        <div id="SpaceButtons" style="display:none">
            <button type="button" id="AddSpotButton" onclick="addingSpot()">
                Add Spot
            </button>
            <select name="Type" id="TypeMenu">
                <option value="#00FF00">Regular</option>
                <option value="#0000FF">Accessible</option>
                <option value="#FF0000">Reserved</option>
            </select>
            <button type="button" id="ChangeSpotButton" onclick="changingSpot()">
                Change Spot Type
            </button>
            <button type="button" id="RemoveSpotButton" onclick="removingSpot()">
                Remove Spot
            </button>
            <button type="button" id="SaveButton" onclick="uploadSpots()">
                Save Changes
            </button>
        </div>
    </div>
    <div id="map"></div>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWaVhLQMYdNjRXmcZga657_etUC-9HBmQ&callback=initMap"></script>
    <script>
        window.onload = function () {
            anno = Annotorious.init({
                image: 'test_lot',
                locale: 'auto',
                drawOnSingleClick: false,
                widgets: [
                    { widget: 'COMMENT' },
                    { widget: 'TAG', vocabulary: ['Default', 'Reserved', 'Accessible'] }
                ]
            });

            anno.setDrawingTool("polygon");

            anno.setAuthInfo({
                id: 'http://www.example.com/yapetej',
                displayName: 'Jonathan'
            });

            anno.on('selectAnnotation', function (a, shape) {
                // console.log('selected');
            });

            anno.on('cancelSelected', function (a) {
                // console.log('cancel');
            });

            anno.on('changeSelected', function (selected, previous) {
                // console.log('changed from', previous, 'to', selected);
            });

            anno.on('createAnnotation', function (annotation) {
                //   console.log('created', annotation);
                // writeToJSON(annotation, anno.getAnnotations());
                createAnnotation(annotation, anno.getAnnotations());
            });

            anno.on('updateAnnotation', function (annotation, previous) {
                console.log('updated', previous, 'with', annotation);
                updateAnnotation(annotation, previous, anno.getAnnotations());
            });

            anno.on('clickAnnotation', function (annotation, shape) {
                // console.log('clicked', annotation);
            });

            anno.on('deleteAnnotation', function (annotation) {
                deleteAnnotation(annotation);
            });

            anno.on('mouseEnterAnnotation', function (annotation) {
                // console.log('enter', annotation);
            });

            anno.on('mouseLeaveAnnotation', function (annotation) {
                // console.log('leave', annotation);
            });

            // anno.loadAnnotations();
            anno.setAnnotations(loadBirdAnn(1));

            var toolToggle = document.getElementById('current-tool');
            toolToggle.addEventListener('click', function () {
                if (toolToggle.innerHTML == 'Rectangle') {
                    toolToggle.innerHTML = 'Polygon';
                    anno.setDrawingTool('polygon');
                } else {
                    toolToggle.innerHTML = 'Rectangle';
                    anno.setDrawingTool('rect');
                }
            });
        }
        // function show(view) {
        //     if (view == "side") {
        //         document.getElementById('test_lot')
        //             .src = getSideURL();
        //         anno.loadAnnotations(getSideAnn());
        //         setView("side");
        //     } else {
        //         document.getElementById('test_lot')
        //             .src = getBirdURL();
        //         anno.loadAnnotations(getBirdAnn());
        //         setView("bird");
        //     }

        // }
    </script>
    <script src="./Annotate.js"></script>
    </div>
</body>

</html>